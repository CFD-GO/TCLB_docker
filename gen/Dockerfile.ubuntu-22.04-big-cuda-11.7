
FROM mcr.microsoft.com/devcontainers/cpp:dev-ubuntu-22.04

COPY tools/install.sh /tmp/
RUN chmod +x /tmp/install.sh

USER vscode
WORKDIR /home/vscode

RUN export DEBIAN_FRONTEND=noninteractive && sudo apt-get update && \
      sudo apt-get -y install --no-install-recommends \
        openssh-server python3-pip 
RUN sudo /tmp/install.sh --group --retry 3 --retry-delay 5 --small --sudo r 
RUN sudo /tmp/install.sh --group --retry 3 --retry-delay 5 --small --sudo openmpi 
RUN /tmp/install.sh --group --retry 3 --retry-delay 5 --small rdep 
RUN sudo /tmp/install.sh --group --retry 3 --retry-delay 5 --small --sudo cuda 11.7 
ENV CUDA_PATH="/usr/local/cuda-11.7"
ENV PATH="${CUDA_PATH}/bin:${PATH}"
ENV LD_LIBRARY_PATH="${CUDA_PATH}/lib64:${LD_LIBRARY_PATH}" 
RUN export DEBIAN_FRONTEND=noninteractive && sudo apt-get update && \
      sudo apt-get -y install --no-install-recommends \
        libxml2 libxml2-dev libgl1-mesa-glx 
RUN /tmp/install.sh --group --retry 3 --retry-delay 5 --small rinside reticulate --rpackage languageserver --rpackage png 
RUN pip3 install vtk
ENV RETICULATE_PYTHON="/usr/bin/python3" 